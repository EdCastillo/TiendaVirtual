

@model dynamic

@{
    ViewBag.Title = "ShowProduct";
    Layout = null;

    

    #region CookiesConfiguration
    //Cookies Configuration
    Views.Models.UserCookie user = new Views.Models.UserCookie();
    CreateOrValidate();
    void CreateOrValidate()
    {
        HttpCookie comp = Request.Cookies["UserCookie"];
        if (comp == null)
        {
            //Crear cookies si no existen
            HttpCookie UserCookie = new HttpCookie("UserCookie");
            UserCookie["US_ID"] = "0";
            UserCookie["Username"] = "Invitado";
            UserCookie["JsonToken"] = "NotValid";
            UserCookie["ListProduct"] = "null";
            UserCookie.Expires.AddHours(5);
            Response.Cookies.Add(UserCookie);


            //cargar cookies existentes
            HttpCookie reqCookies = Request.Cookies["UserCookie"];
            user = new Views.Models.UserCookie();
            user.Username = reqCookies["Username"].ToString();
            user.US_ID = Int32.Parse(reqCookies["US_ID"].ToString());
            user.JsonToken = reqCookies["JsonToken"].ToString();
            if (!reqCookies["ListProduct"].ToString().Equals("null"))
            {
                List<Views.Models.Carrito> list = Newtonsoft.Json.JsonConvert.DeserializeObject<List<Views.Models.Carrito>>(reqCookies["ListProduct"].ToString());
                user.Products = list;
            }
            else
            {
                user.Products = new List<Views.Models.Carrito>();
            }
        }
        else
        {
            //cargar cookies existentes
            HttpCookie reqCookies = Request.Cookies["UserCookie"];
            user = new Views.Models.UserCookie();
            user.Username = reqCookies["Username"].ToString();
            user.US_ID = Int32.Parse(reqCookies["US_ID"].ToString());
            user.JsonToken = reqCookies["JsonToken"].ToString();
            if (!reqCookies["ListProduct"].ToString().Equals("null"))
            {
                List<Views.Models.Carrito> list = Newtonsoft.Json.JsonConvert.DeserializeObject<List<Views.Models.Carrito>>(reqCookies["ListProduct"].ToString());
                user.Products = list;
            }
            else
            {
                user.Products = new List<Views.Models.Carrito>();
            }
        }
    }
    #endregion
}
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>
<body style="background-color:#E8D0F9">

    <div class="jumbotron">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <table class="table">
                <tr class="col-lg-12 col-md-12 col-sm-12 text-center">
                    <td class="col-4 center-block text-center">
                        <button class="btn btn-light btn-large btn-block text-center btn-outline-secondary center-block" onclick="window.location.href = '/Producto/AllProducts'">
                            <div class="btn-outline-secondary">Home</div>
                        </button>
                    </td>
                    <td class="col-4">
                        <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                    </td>
                    <td class="col-4 center-block">
                        <button class="btn btn-outline-success glyphicon-align-center my-2 my-sm-0" type="submit">Search</button>
                    </td>
                </tr>
            </table>
        </nav>
    </div>
    <div class="container">
        <div class="container p-3 my-3 bg-dark text-white text-center">
            <h4 class="Display-2 text-center text-uppercase">
                @Model.Producto.PRO_NOMBRE
            </h4>
            <div id="carouselExampleControls" class="carousel slide active" data-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img class="d-block w-100" src="..." style="resize:" alt="First slide">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="..." alt="Second slide">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="..." alt="Third slide">
                    </div>
                </div>
                <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only"></span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only"></span>
                </a>
            </div>
            <h5 class="Display-5">@Model.Producto.PRO_MARCA</h5>
            <h5 class="Display-5">@Model.Producto.PRO_DESCRIPCION</h5>
            <h5 class="Display-5">₡@Decimal.ToInt32(Model.Producto.PRO_PRECIO)</h5>
            <table class="table">
                <tr class="col-lg-12">
                    <td colspan="2">
                        <input class="form-control text-center center-block" type="number" value="0" id="productcounter">
                    </td>
                </tr>
                <tr class="col-sm-12 col-lg-6 col-md-6">
                    <td>
                        <button type="button" value="Add" class="btn btn-outline-light btn-block btn-lg" id="botonCarrito" style="width:100%">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart-plus" viewBox="0 0 16 16">
                                <path d="M9 5.5a.5.5 0 0 0-1 0V7H6.5a.5.5 0 0 0 0 1H8v1.5a.5.5 0 0 0 1 0V8h1.5a.5.5 0 0 0 0-1H9V5.5z" />
                                <path d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1H.5zm3.915 10L3.102 4h10.796l-1.313 7h-8.17zM6 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm7 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
                            </svg>
                        </button>
                    </td>
                    <td class="col-sm-12 col-lg-6 col-md-6">
                        <button class="btn btn-outline-light btn-block btn-lg" style="width:100%" type="button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share" viewBox="0 0 16 16">
                                <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5zm-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z" />
                            </svg>
                        </button>
                    </td>
                </tr>
            </table>

        </div>
        <script>
        var counter = document.getElementById('productcounter');
            var agregar = document.getElementById('botonCarrito');
            onchange();
            agregar.onclick = agregaraCarrito;
        function onchange() {
            counter.onchange = limit;
        }
        function limit() {
            if (counter.value < 0) {
                counter.value = 0;
            }
            else if (counter.value >@Model.Producto.PRO_STOCK) {
                counter.value=@Model.Producto.PRO_STOCK;
            }
        }
        function agregaraCarrito() {
            console.log('agregaraCarrito');
            var username = "@user.Username";
            if (username =="Invitado") {
                window.location.href = '/Carrito/add?id=' +@Model.Producto.PRO_ID+'&cantidad=' + document.getElementById('productcounter').value;
            }
            else {
                window.location.href = '/Carrito/add?id=' +@Model.Producto.PRO_ID+'&cantidad=' + document.getElementById('productcounter').value + '&userID=' +@user.US_ID+"&token=" + '@String.Format(user.JsonToken)';
            }
        }
        </script>
    </div>
    
</body>

